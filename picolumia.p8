pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- picolumia
-- by andrew edstrom

local board
local player
local next_quad
local speed_timer
local speed
local last_direction_moved -- "right" or "left"
local game_state -- "playing", "gameover", "menu", "won"
local hard_dropping
local number_of_sounds=10
local combo_size

-- player-chosen settings
local display_shadow

-- coroutines
local drawing_combo_text
local blocks_clearing

-- values to display in hud
local cleared
local score
local level
local seconds_elapsed
local seconds_timer

-- block types
local white_block = 8
local red_block = 16
local yellow_block = 24
local blue_block = 32
local empty = 40
local wall = -1

-- board constants
local board_outline_color = 13
local board_left = 8 -- Used to center the board
local board_height = 27 -- must be odd for math to work out
local board_width = 8
local bottom = 117
local piece_width = 8
local piece_height = 4
local sprite_size = 6

-- game feel thiccness
local x_shift
local y_shift
local shimmy_coefficient=1.4
local shimmy_degredation_rate=.93
local minimum_shimmy_threshold=.8
local fade_speed=0.05
local current_fade_perc=0
local loading=false

-- set up palette

#include utils.lua
#include config.lua
#include juice.lua
#include clearing-blocks.lua
#include audio.lua
#include movement.lua
#include fancy-printing.lua
#include game-objects.lua
#include init.lua
#include update.lua
#include draw.lua

__gfx__
00000000007700000088000000aa000000cc00000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007007000080080000aaaa0000cccc0000111100000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007007000070080880800aaaaaa00cc00cc001111110000606000000000000000000000000000000000000000000000000000000000000000000000000000
000770007000070080880800aaaaaa00cc00cc001111110000066000000000000000000000000000000000000000000000000000000000000000000000000000
0007700007007000080080000aaaa0000cccc0000111100000666000000000000000000000000000000000000000000000000000000000000000000000000000
00700700007700000088000000aa000000cc00000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07700000000007000000000000070000000000077000000000000700000000000700000000700000700000000000000007000000700000000070000000000000
07070000000007000000000000700000000000700700000000000700000000000700000000700000700000000000000007000000700000000070000000000000
07007000000007000000000007000000000007000070000000000700000000000700000000700000770000000000000077000000700000000707000000000000
07000700000007000000000070000000000070000007000000000700000000000700000000700000770000000000000077000000700000000707000000000000
07000070000007000000000700000000000700000000700000000700000000000700000000700000707000000000000707000000700000000707000000000000
07000007000007000000007000000000007000000000070000000700000000000700000000700000707000000000000707000000700000000707000000000000
07000007000007000000070000000000070000000000007000000700000000000700000000700000700700000000007007000000700000007000700000000000
07000070000007000000700000000000700000000000000700000700000000000700000000700000700700000000007007000000700000007000700000000000
07000700000007000007000000000007000000000000000070000700000000000700000000700000700070000000070007000000700000007000700000000000
07007000000007000007000000000007000000000000000070000700000000000700000000700000700070000000070007000000700000070000070000000000
07070000000007000000700000000000700000000000000700000700000000000700000000700000700007000000700007000000700000070000070000000000
07700000000007000000070000000000070000000000007000000700000000000700000000700000700007000000700007000000700000077777770000000000
07000000000007000000007000000000007000000000070000000700000000000700000000700000700000700007000007000000700000700000007000000000
07000000000007000000000700000000000700000000700000000700000000000700000000700000700000700007000007000000700000700000007000000000
07000000000007000000000070000000000070000007000000000700000000000770000007700000700000070070000007000000700000700000007000000000
07000000000007000000000007000000000007000070000000000700000000000070000007000000700000070070000007000000700000700000007000000000
07000000000007000000000000700000000000700700000000000700000000000077000077000000700000007700000007000000700007000000000700000000
07000000000007000000000000070000000000077000000000000777777770000007777770000000700000000000000007000000700007000000000700000000
__sfx__
010f00000c05511005130051300514005130050e00500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005
011000000c05500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000001105500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010e00001505500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000001c05500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000001805500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000001105500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000001305500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010e00001505500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005
011000001d05500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005
011000001a05500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000000056300403005030050300503005030050300503005030050300503005030050300503005030050300503005030050300503005030050300503005030050300503005030050300503005030050300503
010c0000000550e0510e050000000c055000001104513041130400000010065000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010c0000000550e0510e040000000c045000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010c00000505513031130300000010035000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010b0000000550e0510e050000000c04500000110451303113030000001005500000180651c0611c0600000018065000001306218060180501802018015000000000000000000000000000000000000000000000
010d00001101411020110201101500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000c00001501415010130101301500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010c00001701418020180221801200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000002401500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000002601200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000f00002401200000007000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000b0000150341502013025000000000000000000000000000000000000000000000000001302013025000000000000000000001c0201c0201c0101c015000000000000000000000000000000000000000000000
000b0000170341802018025000000000000000000000000000000000000000000000000001802018022000000000000000000002b0202b0102b01500000000000000000000000000000000000000000000000000
01130000000550e0510e0430d0410d0430c0410c0430b0410b0530a0510a053090510905308051080530705106051060510605106051060511205113053000001604217060000000000000000000000000000000
__music__
04 00021344
04 0a085844
04 02035344
04 00050715
04 01020315
04 03050415
04 10111244
04 0d111244
04 0e111244
04 10110d44
04 0f161744

